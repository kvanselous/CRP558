<!DOCTYPE html>
  <html>
    <head>
      <title>Assignment 2</title>   
       <!--//code to help build drop down menu from: https://www.w3schools.com/howto/howto_css_dropdown.asp    -->    
       <!--//code to help build maps and data from lecture LA 558 course materials and videos -->
       <!--//www.washingtonpost.com/graphics/2019/investigations/dea-pain-pill-database/ Inserted pill data into County data-->
	   <!--//open-iowa.opendata.arcgis.com/datasets/8a1c2d500d8847d79aa47d45d44eb133_0  Created Geojson in QGIS-->
       <!--//https://leafletjs.com/examples/choropleth/-->
          <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">
      <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
                 crossorigin=""></script> 
	    
        <script src="../Assignment2/GeoJson/2014Pills"></script>
	             <script src="../Assignment2/GeoJson/2014morality"></script>
    <style>
 ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: #333;
}

li {
  float: left;
}

li a, .dropbtn {
  display: inline-block;
  color: white;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

li a:hover, .dropdown:hover .dropbtn {
  background-color: red;
}

li.dropdown {
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1001;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {background-color: #f1f1f1;}

.dropdown:hover .dropdown-content {
  display: block;
}
	    
	                        #map {
                    width: 700px;
                    height: 500px;
                    background-color:blue
                    z-index: -1      
 }
        .info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}
               
.legend {
    line-height: 10px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 20px;
    float: left;
    margin-right: 8px;
    opacity: 0.9;
}
.info {
    padding: 6px 8px;
    font: 10px/20px Arial, Helvetica, sans-serif;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}
</style>
</head>
<body>   
      <ul>
        <li><a href="https://kvanselous.github.io/CRP558/">Home</a></li>
        <li class="dropdown">
                <a href="javascript:void(0)" class="dropbtn">Assignments</a>
            <div class="dropdown-content"> 
        <a href="https://kvanselous.github.io/CRP558/Assignment1/">Assignment 1</a>
        <a href="https://kvanselous.github.io/CRP558/Assignment2/">Assignment 2</a>
          </div>
        <li class="dropdown">
             <a href="javascript:void(0)" class="dropbtn">Exercises</a>
          <div class="dropdown-content"> 
        <a href="https://kvanselous.github.io/CRP558/exercise1/">Exercise 1</a>           
        <a href="https://kvanselous.github.io/CRP558/exercise2/">Exercise 2</a>
        <a href="https://kvanselous.github.io/CRP558/exercise3/">Exercise 3</a>
        <a href="https://kvanselous.github.io/CRP558/exercise4/">Exercise 4</a>
        <a href="https://kvanselous.github.io/CRP558/exercise5/">Exercise 5</a>   
        <a href="https://kvanselous.github.io/CRP558/exercise6/">Exercise 6</a>  
        <a href="https://kvanselous.github.io/CRP558/exercise7/">Exercise 7</a>  
        <a href="https://kvanselous.github.io/CRP558/exercise8/">Exercise 8</a>  
        <a href="https://kvanselous.github.io/CRP558/exercise9/">Exercise 9</a>  
        <a href="https://kvanselous.github.io/CRP558/exercise10/">Exercise 10</a>  
        </div>        
        <li><a href="https://kvanselous.github.io/CRP558/TechReport/">Tech Report</a></li>
    
     </li>
  </ul>
        <h3>Assignment 2</h3>
      <br><b>Substance Use in Iowa</b>
      <br><em>A county level comparison of pain pill distribution rates and subsance related mortaltiy rates across Iowa</em>
          <br><em>Data released from The Washington Post and The Center for Disease Control for 2014</em></p>
	<p>The map below displays a map of Iowa with options to display an open street map, a world imagery map, a cholorpleth map, and a graduated symbols map.  The graduated symbols map displays the mortaltiy rates related to substance use per Iowa county for the year 2014.  The chlorpleth map displays the pain pill distrbution rate of pain pills distributed per person per county for the year of 2014.  Utilize the layer control, in the top right hand side of the map to turn the layers on and off.  Use the buttons at the bottom of the map to zoom into an urban area and a rural area. </p>
    <h6>What are the differences between urbal and rural areas? </h6>
    <p>The buttons allow the viewer to zoom into an urban area and a rural area.  What differences do you notice? What similarities do you notice?</p>
    <img src="images/CassCounty.png" width ="600" height = "400" alt="Cass County">  
    <img src="images/Dallas%20County.png" width="600" height ="400" alt="Dallas County">
<div id="map"></div>
All code must include comments (not necessarily a comment for each line but a comment for each main section) (2 pts)
External GeoJSON data with data sources listed in the map or on the bottom of the page (3 pts)
Popup for at least one vector layer (1 pts)
One choropleth map (2 pts)
One point layer as graduated symbols, clusters or heat map (2 pts)
Layer Control with at least two basemap options and two overlays (vector or raster) (4 pts)
Leaflet legend to help the reader understand the map -  legend should not display if layer is not displayed in map (4 pt)
A brief narrative explaining your map project with formatted text - correct html formatting used (<p>, <br>, <b>, etc) (2 pts)
One image (2 pts)
A designed page(s) using proper CSS to organize the page and including your navigation bar (2 pts)
GeoJSON and Image files organized in geojson / image directories (1 pt) 
<!--Buttons<br>-->
Press the button to zoom into Des Moines.  Turn on and off the layers to see geographic layers that make up this area: <button id="UrbanBtn">Go to Urban Area</button>
Press the button to zoom into Rural County.  Turn on and off the layers to see the dusbance use issues: <button id="RuralBtn">Go to Rural Area</button>  
      
  <script> 
  		// 2 basemaps		
		var OSM = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
   		 attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
    		 maxZoom: 18
		 });	 
      var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	   attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });

		 //map		
		 var map = L.map('map', {
  		 center: [41.95, -93.30],
  		 zoom: 7,
  	  	 layers: [OSM, Esri_WorldImagery]
		});
      
	   //two Overlays
      var iowaMortality = L.geoJSON(mortality);
      
      var iowaPills = L.geoJSON(painpills, {
        style: style});


// polygon choropleth map 
function getColor(d) {
		return d  > 30  ? '#54278f' :
				d     > 25  ? '#756bb1' :
				d > 20  ? '#9e9ac8' :
				d > 15   ? '#bcbddc' :
				d > 10   ? '#dadaeb' :
				d > 5   ? '#f2f0f7' :
               "#FFFFFF"; 
	}
      
//set color of graduate symbols
function getColor(m) {
  return m > 45 ? '#253494' :
    m > 35 ? "#2c7fb8" :
    m > 25 ? "#41b6c4" :
    m >15 ? "#a1dab4" :
    m >5 ? "#ffffcc" :
    "#FFFFFF"; //white
}
	  
	function style(feature) {
		return {
			weight: 1,
			opacity: 1,
			color: 'white',
			fillOpacity: 0.7,
			fillColor: getColor(feature.properties.PillRate)
		};
	}

	function highlightFeature(e) {
		var layer = e.target;
        info.update(layer.feature.properties);

		layer.setStyle({
			weight: 2,
			color: 'black',
			dashArray: '',
			fillOpacity: 0.7
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

	}

	var geojson;

	function resetHighlight(e) {
		geojson.resetStyle(e.target);
        info.update();
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}

      // legend

      var legend = L.control({
        position: 'bottomright'
      });

      legend.onAdd = function(map) {

       var div = L.DomUtil.create('div', 'info legend'),
        PillDist = [0, 10, 15, 20, 25, 30],
        labels = [];

       for (var i = 0; i < PillDist.length; i++) {
         div.innerHTML +=
         '<i style="background:' + getColor(PillDist[i] + 1) + '"></i> ' +
            PillDist[i] + (PillDist[i + 1] ? '&ndash;' + PillDist[i + 1] + '<br>' : '+');
    }
        
        return div;
        };

       legend.addTo(map);


      //layer control
		var baseMap = {
		"OpenStreetMap": OSM,
        "ESRI World Imagery":Esri_WorldImagery
		};
       		
		var overlayMaps = {
        "Pain Pill Distribution Per Person Per Year 2014": iowaPills,
        "Substance Use Mortalty Rate 2014": iowaMortality
		};			

		L.control.layers(baseMap, overlayMaps).addTo(map);	
      
      geojson = L.geoJson(pill, {
		style: style,
		onEachFeature: onEachFeature
	   })
    
      //functions for buttons   
      document.getElementById("UrbanBtn").addEventListener("click", Urban);     
      function Urban() {
      map.setView(new L.LatLng(41.5868, -93.6250),10);
        }; 
      document.getElementById("RuralBtn").addEventListener("click", Rural);     
      function Rural() {
       map.setView(new L.LatLng(40.7069, -91.4435),10);
                    }; 
     </script>
   </body>
</html>

